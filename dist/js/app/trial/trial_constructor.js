define(["require","jquery","underscore","utils/pubsub","utils/interface/interface","app/stimulus/stimulus_collection","./interactions","./current_trial","../inflator","app/task/main_view"],function(t){var i=t("jquery"),e=t("underscore"),s=t("utils/pubsub"),n=t("utils/interface/interface"),a=t("app/stimulus/stimulus_collection"),r=t("./interactions"),u=t("./current_trial"),c=t("../inflator"),o=t("app/task/main_view"),l=0,d=function(t){var s=c(t,"trial");if(e.extend(this,s),this.data||(this.data={}),this._source=s,this._id=e.uniqueId("trial_"),this.counter=l++,!this.interactions)throw new Error("Interactions not defined");this._layout_collection=new a(this.layout||[],{trial:this}),this._stimulus_collection=new a(this.stimuli||[],{trial:this}),this._pubsubStack=[],this._next=["next",{}],this.deferred=i.Deferred()};return e.extend(d.prototype,{activate:function(){var t=this;return u(this),this._layout_collection.display_all(),s.subscribe("trial:end",this._pubsubStack,e.bind(this.deactivate,this)),s.subscribe("trial:setAttr",this._pubsubStack,function(i,s){e.isFunction(i)?i.apply(t,[t.data,s]):e.extend(t.data,i)}),s.subscribe("trial:setInput",this._pubsubStack,function(t){n.add(t)}),s.subscribe("trial:removeInput",this._pubsubStack,function(t){"All"==t||e.include(t,"All")?n.destroy():n.remove(t)}),s.subscribe("trial:goto",this._pubsubStack,function(i){t._next=[i.destination,i.properties||{}]}),n.add(this.input||[]),this._stimulus_collection.activate(),n.resetTimer(),r.activate(this.interactions),this.deferred.promise()},deactivate:function(){var t=this;n.destroy(),this._stimulus_collection.disable(),r.disable(),e.each(this._pubsubStack,function(t){s.unsubscribe(t)}),this._pubsubStack=[],u(void 0),document.all&&!document.addEventListener?setTimeout(function(){o.empty(),t.deferred.resolve(t._next[0],t._next[1])},1):(o.empty(),t.deferred.resolve(t._next[0],t._next[1]))},name:function(){return this.data.alias?this.data.alias:this.inherit&&this.inherit.set?this.inherit.set:!1}}),d});
//# sourceMappingURL=trial_constructor.js.map