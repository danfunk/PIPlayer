define("extensions/dscore/computeD",["jquery","app/API"],function(r,a){var e={dataArray:{},AnalyzedVar:"latency",ErrorVar:"error",condVar:"",cond1VarValues:[],cond2VarValues:[],parcelVar:"",parcelValue:[],fastRT:300,maxFastTrialsRate:.1,minRT:400,maxRT:1e4,maxErrorParcelRate:.4,errorLatency:{use:"latency",penalty:600,useForSTD:!0},postSettings:{}};return r.extend(e,{setComputeObject:function(a){r.extend(this,a)},setDataArray:function(){this.dataArray=a.getLogs()}}),e}),define("extensions/dscore/msgMan",["jquery","underscore"],function(r,a){var e={MessageDef:[],manyErrors:"There were too many errors made to determine a result.",tooFast:"There were too many fast trials to determine a result.",notEnough:"There were not enough trials to determine a result."},t={setMsgObject:function(a){r.extend(e,a)},getScoreMsg:function(r){var t=e.MessageDef;if(!t||!t.length)throw new Error('You must define a "MessageDef" array.');var n=parseFloat(r),o=null,c=null,s="error: msg was not set",l=!1;if(a.each(t,function(r){o=parseFloat(r.cut),c=r.message,o>=n&&!l&&(s=c,l=!0)}),!l){var u=t.length,i=t[u-1];s=i.message}return s},getMessage:function(r){return e[r]}};return t}),define("extensions/dscore/parcelMng",["jquery","app/API","underscore","./msgMan"],function(r,a,e,t){var n={};return r.extend(n,{parcelArray:[],scoreData:{},Init:function(r){var o=a.getLogs();n.parcelArray=[],n.scoreData={};var c=r.AnalyzedVar,s=r.ErrorVar,l=r.parcelVar,u=r.parcelValue,i=r.minRT,g=r.maxRT,d=r.fastRT,f=0,v=0,y=0,h=0,p=parseFloat(r.maxFastTrialsRate);if("undefined"==typeof u||0===u.length){y=0,f=0,v=0,h=0;var V={};V.name="general",V.trialIData=[],e.each(o,function(a){a[c]>=i&&a[c]<=g?(y++,1==a.data[s]&&h++,n.validate(V,a,r)&&f++):a[c]<=d&&v++}),n.checkErrors(y,h,r),n.parcelArray[0]=V}else e.each(u,function(a,t){y=0,f=0,v=0,h=0;var u={};u.name=a,u.trialIData=[],e.each(o,function(e){var t=e.data[l];t==a&&(e[c]>=i&&e[c]<=g?(y++,1==e.data[s]&&h++,n.validate(u,e,r)&&f++):e[c]<=d&&v++)}),n.checkErrors(y,h,r),n.parcelArray[t]=u});v/f>p&&(n.scoreData.errorMessage=t.getMessage("tooFast"))},checkErrors:function(r,a,e){var o=e.maxErrorParcelRate;a/r>o&&(n.scoreData.errorMessage=t.getMessage("manyErrors"))},validate:function(r,a,e){var t=e.errorLatency,n=e.ErrorVar,o=a.data;return"latency"==t.use?(r.trialIData.push(a),!0):"false"==t.use?"1"==o[n]?!1:(r.trialIData.push(a),!0):"penalty"==t.use?(r.trialIData.push(a),!0):void 0},addPenalty:function(r,a){var t=a.errorLatency;if("penalty"==t.use){var o=parseFloat(t.penalty),c=a.ErrorVar,s=a.AnalyzedVar,l=a.condVar,u=a.cond1VarValues,i=a.cond2VarValues,g=r.trialIData,d=r.avgCon1,f=r.avgCon2;e.each(g,function(r){var a=r.data,e=a[c],t=a[l],g=n.checkArray(t,u),v=n.checkArray(t,i);"1"==e&&(g?r[s]+=d+o:v&&(r[s]+=f+o))})}},avgAll:function(r){e.each(n.parcelArray,function(a){n.avgParcel(a,r)})},avgParcel:function(r,a){var o=r.trialIData,c=a.condVar,s=a.cond1VarValues,l=a.cond2VarValues,u=a.AnalyzedVar,i=0,g=0,d=0,f=0,v=0,y=0;e.each(o,function(r){var a=r[u],e=r.data;d+=a,y++;var t=e[c],o=n.checkArray(t,s),h=n.checkArray(t,l);o?(f++,i+=a):h&&(v++,g+=a)}),(2>=f||2>=v)&&(n.scoreData.errorMessage=t.getMessage("notEnough")),0!==f&&(i/=f),0!==v&&(g/=v),r.avgCon1=i,r.avgCon2=g,r.diff=r.avgCon1-r.avgCon2,0!==y&&(r.avgBoth=d/y),n.addPenalty(r,a)},checkArray:function(r,a){for(var e=0;e<a.length;e++){var t=a[e];if(t==r)return!0}return!1},varianceAll:function(r){e.each(n.parcelArray,function(a){n.varianceParcel(a,r)})},varianceParcel:function(r,a){var t=a.AnalyzedVar,o=r.trialIData,c=a.cond1VarValues,s=a.cond2VarValues,l=a.condVar,u=r.avgBoth,i=0,g=0,d=[],f=[],v=[],y=a.errorLatency,h=y.useForSTD;e.each(o,function(r){var e=r.data,o=r[t],u=a.ErrorVar,i=e[u],g=e[l],v=n.checkArray(g,c),y=n.checkArray(g,s);v?h?d.push(o):"0"==i&&d.push(o):y&&(h?f.push(o):"0"==i&&d.push(o))}),v=d.concat(f),e.each(v,function(r){var a=r;i=a-u,g+=i*i}),r.variance=g/(v.length-1)},scoreAll:function(r){var a=0;e.each(n.parcelArray,function(e){n.scoreParcel(e,r),a+=e.score});var t=a/n.parcelArray.length;n.scoreData.score=t.toFixed(2)},scoreParcel:function(r){var a=Math.sqrt(r.variance);0===a?(n.scoreData.errorMessage=t.getMessage("notEnough"),r.score=r.diff):r.score=r.diff/a},simulateOldCode:function(r){var a=[],t=[2,3,5,6],o=r.cond1VarValues,c=r.cond2VarValues,s=r.condVar,l=r.ErrorVar,u=r.AnalyzedVar,i=n.parcelArray[0],g=n.parcelArray[1],d=i.trialIData,f=g.trialIData;e.each(d,function(r){var e=r.data,i=e[s],g=n.checkArray(i,o),d=n.checkArray(i,c),f={};g?(f.block=t[0],f.lat=r[u],f.err=e[l]):d&&(f.block=t[2],f.lat=r[u],f.err=e[l]),a.push(f)}),e.each(f,function(r){var e=r.data,i=e[s],g=n.checkArray(i,o),d=n.checkArray(i,c),f={};g?(f.block=t[1],f.lat=r[u],f.err=e[l]):d&&(f.block=t[3],f.lat=r[u],f.err=e[l]),a.push(f)});var v=n.scoreTask(a,t);return v}}),n}),define("extensions/dscore/Scorer",["jquery","app/API","underscore","./computeD","./msgMan","./parcelMng"],function(r,a,e,t,n,o){var c={};return r.extend(c,{addSettings:function(r,a){"compute"==r?t.setComputeObject(a):"message"==r&&n.setMsgObject(a)},init:function(){!!window.console||(console={}),console.log||(console.log=function(){})},computeD:function(){c.init(),t.setDataArray(),o.Init(t),o.avgAll(t),o.varianceAll(t),o.scoreAll(t);var r=o.scoreData,a={};return void 0===r.errorMessage||null===r.errorMessage?(a.FBMsg=c.getFBMsg(r.score),a.DScore=r.score):(a.FBMsg=r.errorMessage,a.DScore=""),a},getInfo:function(){},postToServer:function(a,e,n,o){var c=t.postSettings||{},s=c.url;n||(n=c.score),o||(o=c.msg);var l={};return l[n]=a,l[o]=e,r.post(s,JSON.stringify(l))},dynamicPost:function(a){var e=t.postSettings||{},n=e.url;return r.post(n,JSON.stringify(a))},getFBMsg:function(r){var a=n.getScoreMsg(r);return a}}),c});
//# sourceMappingURL=Scorer.js.map